<!DOCTYPE html>
<head html-src="../website/head.html"></head>
<body>
    <header html-src="../website/header.html"></header>
    <main>
        <label>
            Two-row-per line writing system?
            <input type="checkbox">
        </label>
        <label>
            Text to convert to Milaru writing system
            <textarea oninput="writeText(this.value)"></textarea>
        </label>
        <svg id="svgDisplay" width="1000" height="500">
            <g>
                <line x1="0" y1="0" x2="100" y2="200" style="stroke:rgb(255,0,0);stroke-width:2" />
                <line x1="0" y1="0" x2="150" y2="200" style="stroke:rgb(255,0,0);stroke-width:2" />
            </g>
            <g>
                <line x1="50" y1="0" x2="100" y2="200" style="stroke:rgb(255,0,0);stroke-width:2" />
                <line x1="50" y1="0" x2="150" y2="200" style="stroke:rgb(255,0,0);stroke-width:2" />
            </g>
        </svg>
    </main>
    <footer html-src="../website/footer.html"></footer>
</body>
<script src="../website/scripts.js"></script>
<script src="./milaru.js"></script>
<script>
    // Milaru writing font config
    const CharBase = {
        // Character base
        x1: 25, y: 50,
        x2: 55,
        yDiff: 10 // Spacing between empty vowel
    },
    CharCon = {
        // consonant rotation difference
        xDiff: 10,
        yDiff: 20,
    },
    CharVowel = {
        x1: 80, x2: 100,
        xDiff: -15, // Spacing between first and second vowel stroke
        y1Top: 10, y1Bottom: 90, // first point top and bottom of the stroke
        yDiff: 20, // Spacing between the start and the end of stroke
    };
</script>
<script>
    const namespace = 'http://www.w3.org/2000/svg';
    let svg = document.getElementById('svgDisplay');

    function writeText(text) {
        text = splitText(text);
        let row = 0; col = 0;

        // clean svg
        svg.innerHTML = '';

        for (const syll of text) {
            // create writing box
            let box = document.createElementNS(namespace, 'g');
            box.setAttribute('transform', `translate(${col * 100}, ${row * 100})`);
            box.setAttribute('stroke-width', 10);
            box.setAttribute('stroke', 'green');
            box.setAttribute('stroke-linecap', 'round')

            if (syll.group == 0) {
                let base = document.createElementNS(namespace, 'line');
                base.setAttribute('x1', CharBase.x1);
                base.setAttribute('y1', CharBase.y - CharBase.yDiff);
                base.setAttribute('x2', CharBase.x2);
                base.setAttribute('y2', CharBase.y - CharBase.yDiff);

                let base2 = base.cloneNode();
                base2.setAttribute('y1', CharBase.y + CharBase.yDiff);
                base2.setAttribute('y2', CharBase.y + CharBase.yDiff);

                box.append(base, base2)
            } else if (syll.group <= 4) {
                // consonant syllable
                let base = document.createElementNS(namespace, 'line');
                base.setAttribute('x1', CharBase.x1);
                base.setAttribute('y1', CharBase.y);
                base.setAttribute('x2', CharBase.x2);
                base.setAttribute('y2', CharBase.y);

                let group = document.createElementNS(namespace, 'line');
                // rod location
                let baseLoc = ((syll.group <= 2))? 1 : 2;
                group.setAttribute('x1', CharBase['x' + baseLoc]);
                group.setAttribute('y1', CharBase.y);
                // rod rotation
                let groupRot = ((syll.group + 1) % 2)? -1 : 1;
                group.setAttribute('x2', group.getAttribute('x1') - CharCon.xDiff * groupRot);
                group.setAttribute('y2', group.getAttribute('y1') - CharCon.yDiff);

                if (syll.index != 1) {
                    // Skip empty
                    let member = group.cloneNode()
                    // convert to number with "~~"
                    member.setAttribute('x2', ~~member.getAttribute('x1') + CharCon.xDiff * (syll.index - 1));
                    member.setAttribute('y2', ~~member.getAttribute('y1') + CharCon.yDiff);

                    box.append(member);
                }

                box.append(base, group);
            } else if (syll.group == 5) {
                // punctuation
                if (row != 0) {
                    // move to next col
                    col++;
                    row = 0;
                    box.setAttribute('transform', `translate(${col * 100}, ${row * 100})`);
                }
                switch(syll.index) {
                    case 1:
                        // hyphen
                        let base = document.createElementNS(namespace, 'line');
                        base.setAttribute('x1', 20);
                        base.setAttribute('y1', CharBase.y);
                        base.setAttribute('x2', 80);
                        base.setAttribute('y2', CharBase.y);

                        box.append(base);
                        break;
                    case 2:
                        let dot = document.createElementNS(namespace, 'circle');
                        dot.setAttribute('cx', 50);
                        dot.setAttribute('cy', 50);
                        dot.setAttribute('r', 5);

                        box.append(dot);
                        break;
                }
                row++; // signal to move to the next col
            }

            if (syll.vowel) {
                let vowel = document.createElementNS(namespace, 'line'),
                    vowLoc = syll.vowel == 1 || syll.vowel == 4; // true for top
                vowel.setAttribute('x1', CharVowel.x1)
                vowel.setAttribute('y1', vowLoc? CharVowel.y1Top : CharVowel.y1Bottom);
                vowel.setAttribute('x2', CharVowel.x2)
                vowel.setAttribute('y2',
                    ~~vowel.getAttribute('y1') + CharVowel.yDiff * (vowLoc? 1 : -1)
                );

                if (syll.vowel >= 3) {
                    // two lines
                    let vowel2 = document.createElementNS(namespace, 'line');
                    vowel2.setAttribute('x1', CharVowel.x1 + CharVowel.xDiff)
                    vowel2.setAttribute('y1', vowLoc? CharVowel.y1Top : CharVowel.y1Bottom);
                    vowel2.setAttribute('x2', CharVowel.x2 + CharVowel.xDiff)
                    vowel2.setAttribute('y2',
                        ~~vowel2.getAttribute('y1') + CharVowel.yDiff * (vowLoc? 1 : -1)
                    );

                    box.append(vowel2)
                }

                box.append(vowel)
            }

            row++
            if (row > 1) {
                row = 0; col++
            }

            svg.append(box);
        }
    }
</script>